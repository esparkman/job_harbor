<div class="sqd-stats-grid">
  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Pending",
    value: @stats.pending_count,
    type: :pending,
    link: pending_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Scheduled",
    value: @stats.scheduled_count,
    type: :scheduled,
    link: scheduled_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "In Progress",
    value: @stats.in_progress_count,
    type: :in_progress,
    link: in_progress_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Failed",
    value: @stats.failed_count,
    type: :failed,
    link: failed_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Blocked",
    value: @stats.blocked_count,
    type: :blocked,
    link: blocked_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Finished (24h)",
    value: @stats.finished_count,
    type: :finished,
    link: finished_jobs_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Active Workers",
    value: @stats.workers_count,
    type: :workers,
    link: workers_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Queues",
    value: @stats.queues_count,
    type: :queues,
    link: queues_path
  ) %>

  <%= render SolidqueueDashboard::StatCardComponent.new(
    label: "Throughput",
    value: "#{@stats.throughput_per_hour}/hr",
    type: :throughput
  ) %>
</div>

<% if @chart_data.present? %>
  <div style="margin-top: 2rem;">
    <%= render SolidqueueDashboard::ChartComponent.new(series: @chart_data, current_range: @chart_range) %>
  </div>
<% end %>

<% if @failure_stats.present? && @failure_stats.any? %>
  <div style="margin-top: 2rem;">
    <%= render SolidqueueDashboard::FailureRatesComponent.new(stats: @failure_stats) %>
  </div>
<% end %>

<% if @stats.recent_failures.any? %>
  <div class="sqd-card" style="margin-top: 2rem;">
    <div class="sqd-card-header">
      <h2 class="sqd-card-title">Recent Failures</h2>
    </div>
    <div class="sqd-table-container">
      <table class="sqd-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Job Class</th>
            <th>Error</th>
            <th>Failed At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @stats.recent_failures.each do |job| %>
            <tr>
              <td><%= link_to job.id, job_path(job), class: "sqd-table-link" %></td>
              <td><code class="sqd-code"><%= job.class_name %></code></td>
              <td><%= truncate(job.error_message || "Unknown error", length: 60) %></td>
              <td><%= job.failed_at&.strftime("%b %d, %H:%M:%S") || "—" %></td>
              <td class="sqd-actions">
                <%= button_to "Retry", retry_job_path(job), method: :post, class: "sqd-btn sqd-btn-sm sqd-btn-secondary" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div style="padding: 1rem; text-align: center;">
      <%= link_to "View All Failed Jobs →", failed_jobs_path, class: "sqd-table-link" %>
    </div>
  </div>
<% end %>
