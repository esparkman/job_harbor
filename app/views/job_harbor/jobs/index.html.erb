<% content_for :header_actions do %>
  <%= form_with url: search_path, method: :get, class: "flex items-center gap-2" do |f| %>
    <%= f.text_field :q, placeholder: "Search jobs...", class: "select", style: "width: 16rem;", value: params[:q] %>
    <%= f.submit "Search", class: "btn btn-secondary btn-sm" %>
  <% end %>
<% end %>

<div class="flex gap-1 mb-4 flex-wrap">
  <%= link_to jobs_path, class: "badge #{@status ? 'badge-secondary' : 'badge-primary'}" do %>
    All <span class="ml-1 opacity-75"><%= @counts[:all] %></span>
  <% end %>

  <%= link_to pending_jobs_path, class: "badge #{@status == 'pending' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-sky"></span> Pending <span class="opacity-75"><%= @counts[:pending] %></span>
  <% end %>

  <%= link_to scheduled_jobs_path, class: "badge #{@status == 'scheduled' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-yellow"></span> Scheduled <span class="opacity-75"><%= @counts[:scheduled] %></span>
  <% end %>

  <%= link_to in_progress_jobs_path, class: "badge #{@status == 'in_progress' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-amber"></span> In Progress <span class="opacity-75"><%= @counts[:in_progress] %></span>
  <% end %>

  <%= link_to failed_jobs_path, class: "badge #{@status == 'failed' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-red"></span> Failed <span class="opacity-75"><%= @counts[:failed] %></span>
  <% end %>

  <%= link_to blocked_jobs_path, class: "badge #{@status == 'blocked' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-zinc"></span> Blocked <span class="opacity-75"><%= @counts[:blocked] %></span>
  <% end %>

  <%= link_to finished_jobs_path, class: "badge #{@status == 'finished' ? 'badge-primary' : 'badge-secondary'}" do %>
    <span class="circle circle-green"></span> Finished <span class="opacity-75"><%= @counts[:finished] %></span>
  <% end %>
</div>

<%= render JobHarbor::JobFiltersComponent.new(
  class_names: @filter_data[:class_names],
  queue_names: @filter_data[:queue_names],
  current_class: @class_name,
  current_queue: @queue_name,
  current_path: request.path,
  params: request.query_parameters
) %>

<% if @status == "failed" && @counts[:failed] > 0 %>
  <div class="flex items-center gap-2 mb-4">
    <%= button_to "Retry All Failed", retry_all_jobs_path(status: "failed"), method: :post, class: "btn btn-secondary btn-sm",
        data: { confirm: "Are you sure you want to retry all failed jobs?" } %>
    <%= button_to "Discard All Failed", discard_all_jobs_path(status: "failed"), method: :delete, class: "btn btn-destructive btn-sm",
        data: { confirm: "Are you sure you want to discard all failed jobs? This cannot be undone." } %>
  </div>
<% end %>

<% if @jobs.empty? %>
  <%= render JobHarbor::EmptyStateComponent.new(
    title: "No jobs found",
    description: @status ? "There are no #{@status.humanize.downcase} jobs." : "There are no jobs in the queue.",
    icon: :jobs
  ) %>
<% else %>
  <div class="card">
    <div class="table-wrapper">
      <table class="sqd-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Job Class</th>
            <th>Queue</th>
            <th>Status</th>
            <th>Scheduled At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @jobs.each do |job| %>
            <%= render JobHarbor::JobRowComponent.new(job: job) %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="flex items-center justify-between mt-4">
    <%= render JobHarbor::PaginationComponent.new(pagy: @pagy) %>
    <%= render JobHarbor::PerPageSelectorComponent.new(
      current_per_page: @per_page,
      current_path: request.path,
      params: request.query_parameters
    ) %>
  </div>
<% end %>
